import React, { useState, useEffect } from 'react';

export default function DMRControlPanel() {
  const [systemData, setSystemData] = useState({
    coreTemp: 2847,
    facilityPower: 14108,
    coolantFlow: 50,
    dmrOutput: 398,
    dmrThermal: 189,
    structuralIntegrity: 100,
    chamberRadiation: 1.2,
  });

  useEffect(() => {
    const interval = setInterval(() => {
      setSystemData(prev => {
        const newTemp = Math.max(2700, Math.min(6100, prev.coreTemp + (Math.random() - 0.5) * 40));
        
        // Integrity starts dropping when temp is above 3500K
        let newIntegrity = prev.structuralIntegrity;
        if (newTemp > 3500) {
          const tempDamage = ((newTemp - 3500) / (6100 - 3500)) * 100;
          newIntegrity = Math.max(0, Math.min(100, 100 - tempDamage + (Math.random() - 0.5) * 5));
        } else {
          newIntegrity = Math.min(100, prev.structuralIntegrity + (Math.random() - 0.5) * 0.5);
        }

        // Radiation increases with temperature and damage
        let newRadiation = 0.8 + (newIntegrity / 100) * 0.4 + (newTemp / 6100) * 0.5;
        newRadiation = Math.max(0.5, Math.min(10, newRadiation + (Math.random() - 0.5) * 0.2));

        return {
          ...prev,
          coreTemp: newTemp,
          facilityPower: Math.max(13500, Math.min(14500, prev.facilityPower + (Math.random() - 0.5) * 100)),
          coolantFlow: Math.max(45, Math.min(65, prev.coolantFlow + (Math.random() - 0.5) * 3)),
          dmrOutput: Math.max(350, Math.min(420, prev.dmrOutput + (Math.random() - 0.5) * 5)),
          dmrThermal: Math.max(160, Math.min(220, prev.dmrThermal + (Math.random() - 0.5) * 4)),
          structuralIntegrity: newIntegrity,
          chamberRadiation: newRadiation,
        };
      });
    }, 500);

    return () => clearInterval(interval);
  }, []);

  // Main LED Grid
  const MainLEDGrid = ({ color, baseColor, rows, cols, intensity }) => {
    const gridRows = [];
    for (let r = 0; r < rows; r++) {
      const row = [];
      for (let c = 0; c < cols; c++) {
        const dist = Math.sqrt(Math.pow(c - cols/2 + 0.5, 2) + Math.pow(r - rows/2 + 0.5, 2));
        const maxDist = Math.sqrt(Math.pow(cols/2, 2) + Math.pow(rows/2, 2));
        const isActive = dist < (maxDist * intensity);
        
        let bgColor = baseColor;
        let shadowColor = 'none';
        if (isActive) {
          bgColor = color;
          shadowColor = `0 0 8px ${color}`;
        }
        
        row.push(
          <div
            key={`${r}-${c}`}
            className="w-4 h-4"
            style={{
              backgroundColor: bgColor,
              boxShadow: shadowColor,
              border: '1px solid #0a0a0a',
              margin: '2px'
            }}
          />
        );
      }
      gridRows.push(
        <div key={r} className="flex">
          {row}
        </div>
      );
    }
    return gridRows;
  };

  // Small compact LED grid
  const SmallLEDGrid = ({ color, baseColor, size, intensity }) => {
    const rows = [];
    for (let r = 0; r < size; r++) {
      const row = [];
      for (let c = 0; c < size; c++) {
        const dist = Math.sqrt(Math.pow(c - size/2 + 0.5, 2) + Math.pow(r - size/2 + 0.5, 2));
        const maxDist = Math.sqrt(2) * size / 2;
        const isActive = dist < (maxDist * intensity);
        
        row.push(
          <div
            key={`${r}-${c}`}
            className="w-2 h-2"
            style={{
              backgroundColor: isActive ? color : baseColor,
              boxShadow: isActive ? `0 0 2px ${color}` : 'none',
              border: '1px solid #0a0a0a',
              margin: '1px'
            }}
          />
        );
      }
      rows.push(
        <div key={r} className="flex">
          {row}
        </div>
      );
    }
    return rows;
  };

  // DMR with energy wave rings
  const DMRDisplay = () => {
    const animate = `
      @keyframes pulse-ring {
        0% {
          r: 15px;
          opacity: 1;
        }
        100% {
          r: 50px;
          opacity: 0;
        }
      }
      @keyframes wave {
        0%, 100% {
          d: path('M 0,20 Q 5,15 10,20 T 20,20');
        }
        50% {
          d: path('M 0,20 Q 5,10 10,20 T 20,20');
        }
      }
    `;

    return (
      <div className="relative w-40 h-40 flex items-center justify-center" style={{ backgroundColor: '#0a0a0a' }}>
        <style>{animate}</style>
        
        {/* Outer pulsing rings */}
        <svg className="absolute w-full h-full" viewBox="0 0 160 160">
          <circle cx="80" cy="80" r="15" fill="none" stroke="#00ff00" strokeWidth="2" style={{
            animation: 'pulse-ring 2s ease-out infinite'
          }} />
          <circle cx="80" cy="80" r="15" fill="none" stroke="#00ff00" strokeWidth="2" style={{
            animation: 'pulse-ring 2s ease-out infinite 0.7s'
          }} />
        </svg>

        {/* Wave patterns around DMR */}
        <svg className="absolute w-full h-full" viewBox="0 0 160 160">
          {/* Top wave */}
          <path d="M 50,40 Q 60,30 70,40 Q 80,50 90,40 Q 100,30 110,40" 
            fill="none" stroke="#00ff00" strokeWidth="1.5" 
            style={{ opacity: 0.7, filter: 'drop-shadow(0 0 4px #00ff00)' }} />
          
          {/* Bottom wave */}
          <path d="M 50,120 Q 60,130 70,120 Q 80,110 90,120 Q 100,130 110,120" 
            fill="none" stroke="#00ff00" strokeWidth="1.5" 
            style={{ opacity: 0.7, filter: 'drop-shadow(0 0 4px #00ff00)' }} />
          
          {/* Left wave */}
          <path d="M 40,50 Q 30,60 40,70 Q 50,80 40,90 Q 30,100 40,110" 
            fill="none" stroke="#00ff00" strokeWidth="1.5" 
            style={{ opacity: 0.7, filter: 'drop-shadow(0 0 4px #00ff00)' }} />
          
          {/* Right wave */}
          <path d="M 120,50 Q 130,60 120,70 Q 110,80 120,90 Q 130,100 120,110" 
            fill="none" stroke="#00ff00" strokeWidth="1.5" 
            style={{ opacity: 0.7, filter: 'drop-shadow(0 0 4px #00ff00)' }} />
        </svg>

        {/* Center DMR core - WHITE */}
        <div className="relative w-16 h-16 rounded-full flex items-center justify-center" style={{
          backgroundColor: '#ffffff',
          boxShadow: '0 0 40px #ffffff, 0 0 80px #ffffff, inset 0 0 20px #ffffff'
        }}>
          <div className="text-black font-bold text-sm" style={{ textShadow: '0 0 4px #ffffff' }}>
            DMR
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="w-screen bg-black overflow-x-auto" style={{ backgroundColor: '#000000' }}>
      <div className="p-4 min-h-screen inline-block" style={{ backgroundColor: '#0a0a0a', minWidth: '100%' }}>
        
        {/* HORIZONTAL LAYOUT */}
        <div className="flex gap-4 h-screen items-stretch">
          
          {/* LEFT PANEL - FACILITY MONITORING */}
          <div className="w-72 flex flex-col gap-3">
            <div className="border-4 border-gray-600 bg-black p-3" style={{ backgroundColor: '#1a1a1a' }}>
              <div className="text-xs font-bold mb-2 tracking-wider" style={{ color: '#888888' }}>
                FACILITY MONITORING
              </div>

              <div className="space-y-2">
                {/* Dmrto Output */}
                <div className="border border-gray-700 bg-black p-2">
                  <div className="text-xs" style={{ color: '#ff6600' }}>DMRTO OUTPUT</div>
                  <div className="text-xl font-bold" style={{ color: '#ff6600', textShadow: '0 0 4px #ff6600' }}>
                    {Math.round(systemData.facilityPower)} K
                  </div>
                </div>

                {/* Coolant Flow */}
                <div className="flex gap-2">
                  <div className="border border-gray-700 bg-black p-2 flex-1">
                    <div className="text-xs" style={{ color: '#0088ff' }}>FLOW</div>
                    <div className="text-lg font-bold" style={{ color: '#0088ff', textShadow: '0 0 4px #0088ff' }}>
                      {Math.round(systemData.coolantFlow)}
                    </div>
                  </div>
                  <div className="border border-gray-700 bg-black p-2 flex-1">
                    <div className="text-xs" style={{ color: '#ff0000' }}>%</div>
                    <div className="text-lg font-bold" style={{ color: '#ff0000', textShadow: '0 0 4px #ff0000' }}>
                      COOLANT
                    </div>
                  </div>
                </div>

                {/* Small status grids */}
                <div className="border border-gray-700 bg-black p-2">
                  <div className="text-xs mb-1" style={{ color: '#0088ff' }}>STATUS</div>
                  <div className="inline-block">
                    <SmallLEDGrid color="#0088ff" baseColor="#001133" size={4} intensity={0.7} />
                  </div>
                </div>

                <div className="flex gap-1 mt-2">
                  {[...Array(8)].map((_, i) => (
                    <div key={i} className="flex-1 h-1" 
                      style={{ 
                        backgroundColor: i < 6 ? '#0088ff' : '#1a1a1a',
                        boxShadow: i < 6 ? '0 0 2px #0088ff' : 'none'
                      }} 
                    />
                  ))}
                </div>
              </div>
            </div>

            {/* Secondary panel */}
            <div className="border-4 border-gray-600 bg-black p-3 flex-1" style={{ backgroundColor: '#1a1a1a' }}>
              <div className="text-xs font-bold mb-2" style={{ color: '#888888' }}>FACILITY STATUS</div>
              <div className="space-y-1 text-xs">
                <div className="border border-gray-700 bg-black p-1 px-2">
                  <span style={{ color: '#0088ff' }}>SYSTEM: </span>
                  <span style={{ color: '#00ff00', textShadow: '0 0 2px #00ff00' }}>ONLINE</span>
                </div>
                <div className="border border-gray-700 bg-black p-1 px-2">
                  <span style={{ color: '#0088ff' }}>STATUS: </span>
                  <span style={{ color: '#00ff00', textShadow: '0 0 2px #00ff00' }}>NOMINAL</span>
                </div>
              </div>
            </div>
          </div>

          {/* CENTER - MAIN DISPLAY */}
          <div className="flex-1 flex flex-col items-center justify-center gap-3 relative" style={{ minWidth: '600px' }}>
            


            {/* TOP LED GRIDS */}
            <div className="flex gap-3 justify-center mb-8">
              {/* Left Yellow */}
              <div className="border-4 border-yellow-600 bg-black p-2" style={{ backgroundColor: '#1a1a00' }}>
                <div className="inline-block">
                  <MainLEDGrid color="#ffff00" baseColor="#332200" rows={5} cols={5} intensity={systemData.facilityPower / 15000} />
                </div>
              </div>

              {/* Center Orange */}
              <div className="border-4 border-orange-600 bg-black p-2" style={{ backgroundColor: '#1a0a00' }}>
                <div className="inline-block">
                  <MainLEDGrid color="#ff8800" baseColor="#330000" rows={5} cols={5} intensity={systemData.coreTemp / 6000} />
                </div>
              </div>

              {/* Right Green */}
              <div className="border-4 border-green-600 bg-black p-2" style={{ backgroundColor: '#0a1a0a' }}>
                <div className="inline-block">
                  <MainLEDGrid color="#00ff00" baseColor="#003300" rows={5} cols={5} intensity={systemData.dmrOutput / 450} />
                </div>
              </div>
            </div>

            {/* CENTER DMR */}
            <div className="flex items-center justify-center mb-8">
              <DMRDisplay />
            </div>

            {/* BOTTOM LED GRIDS */}
            <div className="flex gap-3 justify-center">
              {/* Left Red */}
              <div className="border-4 border-red-700 bg-black p-2" style={{ backgroundColor: '#1a0000' }}>
                <div className="inline-block">
                  <MainLEDGrid color="#ff3333" baseColor="#330000" rows={5} cols={5} intensity={systemData.dmrThermal / 230} />
                </div>
              </div>

              {/* Center Cyan */}
              <div className="border-4 border-cyan-600 bg-black p-2" style={{ backgroundColor: '#0a1a1a' }}>
                <div className="inline-block">
                  <MainLEDGrid color="#00ffff" baseColor="#003333" rows={5} cols={5} intensity={0.6} />
                </div>
              </div>

              {/* Right White */}
              <div className="border-4 border-gray-400 bg-black p-2" style={{ backgroundColor: '#1a1a1a' }}>
                <div className="inline-block">
                  <MainLEDGrid color="#ffffff" baseColor="#333333" rows={5} cols={5} intensity={0.8} />
                </div>
              </div>
            </div>


          </div>

          {/* RIGHT PANEL - REACTOR MONITORING */}
          <div className="w-72 flex flex-col gap-3">
            <div className="border-4 border-gray-600 bg-black p-3" style={{ backgroundColor: '#1a1a1a' }}>
              <div className="text-xs font-bold mb-2 tracking-wider" style={{ color: '#888888' }}>
                REACTOR MONITORING
              </div>

              <div className="space-y-2">
                {/* Core Temperature */}
                <div className="border-2 border-red-700 bg-black p-2" style={{ backgroundColor: '#1a0000' }}>
                  <div className="text-xs tracking-wider" style={{ color: '#ff3333' }}>CORE TEMPERATURE</div>
                  <div className="text-2xl font-bold mt-1" style={{ color: '#ff3333', textShadow: '0 0 8px #ff3333' }}>
                    {Math.round(systemData.coreTemp)}
                  </div>
                  <div className="text-xs" style={{ color: '#666' }}>K</div>
                </div>

                {/* Structural Integrity */}
                <div className="border-2 border-orange-600 bg-black p-2" style={{ backgroundColor: '#1a0a00' }}>
                  <div className="text-xs tracking-wider" style={{ color: '#ff8800' }}>STRUCTURAL INTEGRITY</div>
                  <div className="text-2xl font-bold mt-1" style={{ color: '#ff8800', textShadow: '0 0 8px #ff8800' }}>
                    {Math.round(systemData.structuralIntegrity)}%
                  </div>
                </div>

                {/* Chamber Radiation */}
                <div className="border-2 border-yellow-600 bg-black p-2" style={{ backgroundColor: '#1a1a00' }}>
                  <div className="text-xs tracking-wider" style={{ color: '#ffaa00' }}>CHAMBER RADIATION</div>
                  <div className="text-2xl font-bold mt-1" style={{ color: '#ffaa00', textShadow: '0 0 8px #ffaa00' }}>
                    {Math.round(systemData.chamberRadiation * 10) / 10} SV
                  </div>
                </div>

                {/* LED indicator bank */}
                <div className="flex gap-1 mt-2">
                  {[...Array(8)].map((_, i) => (
                    <div key={i} className="flex-1 h-2" 
                      style={{ 
                        backgroundColor: i < 6 ? '#0088ff' : '#1a1a1a',
                        boxShadow: i < 6 ? '0 0 3px #0088ff' : 'none'
                      }} 
                    />
                  ))}
                </div>
              </div>
            </div>

            {/* Reactor Status */}
            <div className="border-4 border-gray-600 bg-black p-3 flex-1" style={{ backgroundColor: '#1a1a1a' }}>
              <div className="text-xs font-bold mb-2" style={{ color: '#888888' }}>REACTOR STATUS</div>
              <div className="space-y-1 text-xs">
                <div className="border border-gray-700 bg-black p-1 px-2">
                  <span style={{ color: '#ff3333' }}>OFFSET: </span>
                  <span style={{ color: '#00ff00', textShadow: '0 0 2px #00ff00' }}>STABLE</span>
                </div>
                <div className="border border-gray-700 bg-black p-1 px-2">
                  <span style={{ color: '#ff3333' }}>STATUS: </span>
                  <span style={{ color: '#00ff00', textShadow: '0 0 2px #00ff00' }}>OPTIMAL</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* BOTTOM CONTROL BAR - Fixed at bottom */}
      <div className="fixed bottom-0 left-0 right-0 border-t-4 border-gray-700 bg-black p-2 flex gap-2 flex-wrap justify-center" 
        style={{ borderColor: '#666', backgroundColor: '#0a0a0a' }}>
        {[
          { text: 'INTEGRITY', color: '#ff3333' },
          { text: 'THERMAL', color: '#ff3333' },
          { text: 'FAILSAFE', color: '#ff3333' },
          { text: 'COOLANT', color: '#ff8800' },
          { text: 'POWER', color: '#ff8800' },
          { text: 'STATUS', color: '#999' },
          { text: 'MONITOR', color: '#999' },
          { text: 'SYSTEMS', color: '#999' },
          { text: 'ALERT', color: '#999' },
          { text: 'LOCK', color: '#ffff00' },
        ].map((btn, i) => (
          <button
            key={i}
            className="px-2 py-1 border text-xs font-bold tracking-wider hover:opacity-75"
            style={{
              borderColor: btn.color,
              color: btn.color,
              backgroundColor: '#1a1a1a',
              textShadow: `0 0 4px ${btn.color}`,
              fontSize: '10px'
            }}
          >
            {btn.text}
          </button>
        ))}
      </div>
    </div>
  );
}
